<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Gone Feral — Scout & Reaper</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: #F5EDD6; }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: rgba(92,74,46,0.05); }
  ::-webkit-scrollbar-thumb { background: rgba(92,74,46,0.15); border-radius: 3px; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

/* ─── MOCK DATA (mirrors CHIMERA Validation_Results) ─── */
const CHIMERA_SCOUT_DATA = [
  { id: "SCT-001", location: "Oak Park — East Trail", date: "2026-02-03", categories_rated: 18, total_categories: 20, divergence: 2.1, bias_direction: -1.8, zone: "Jackson Hospital District", zone_multiplier: 1.25 },
  { id: "SCT-002", location: "Perry Hill Rd — Median", date: "2026-02-02", categories_rated: 20, total_categories: 20, divergence: 0.8, bias_direction: -0.5, zone: null, zone_multiplier: 1.0 },
  { id: "SCT-003", location: "Cramton Bowl Lot B", date: "2026-02-01", categories_rated: 15, total_categories: 20, divergence: 5.4, bias_direction: 3.2, zone: "Downtown Core", zone_multiplier: 1.5 },
  { id: "SCT-004", location: "Oak Park — Pavilion", date: "2026-01-30", categories_rated: 20, total_categories: 20, divergence: 1.2, bias_direction: -1.0, zone: "Jackson Hospital District", zone_multiplier: 1.25 },
  { id: "SCT-005", location: "Garrett Coliseum Perimeter", date: "2026-01-28", categories_rated: 17, total_categories: 20, divergence: 3.7, bias_direction: -2.9, zone: null, zone_multiplier: 1.0 },
];

const CHIMERA_REAPER_DATA = [
  { id: "RPR-001", location: "Oak Park — Creek Bank", date: "2026-02-04", duration_min: 45, distance_mi: 1.2, weight_lbs: 12.5, items_collected: 34, validated: true, zone: "Jackson Hospital District", zone_multiplier: 1.25 },
  { id: "RPR-002", location: "Perry Hill Rd — Ditch", date: "2026-02-03", duration_min: 22, distance_mi: 0.4, weight_lbs: 4.2, items_collected: 18, validated: true, zone: null, zone_multiplier: 1.0 },
  { id: "RPR-003", location: "Oak Park — Lot Edge", date: "2026-02-02", duration_min: 68, distance_mi: 2.1, weight_lbs: 23.8, items_collected: 52, validated: true, zone: "Jackson Hospital District", zone_multiplier: 1.25 },
  { id: "RPR-004", location: "Cramton Bowl — North Side", date: "2026-01-31", duration_min: 30, distance_mi: 0.8, weight_lbs: 8.1, items_collected: 21, validated: true, zone: "Downtown Core", zone_multiplier: 1.5 },
  { id: "RPR-005", location: "Federal Dr — Roadside", date: "2026-01-29", duration_min: 55, distance_mi: 1.5, weight_lbs: 17.3, items_collected: 41, validated: false, zone: null, zone_multiplier: 1.0 },
];

/* ─── XP CALCULATIONS ─── */
function calcScoutXP(entry) {
  const base = 50;
  const accuracyBonus = Math.round(Math.max(0, (1 - entry.divergence / 10)) * 25);
  const raw = base + accuracyBonus;
  const final = Math.round(raw * entry.zone_multiplier);
  return { base, accuracyBonus, raw, multiplier: entry.zone_multiplier, final };
}

function calcReaperXP(entry, hasStreak) {
  const base = 50;
  const timeBonus = Math.min(entry.duration_min, 60);
  const distBonus = Math.min(Math.round(entry.distance_mi * 20), 40);
  const streakBonus = hasStreak ? 15 : 0;
  const raw = base + timeBonus + distBonus + streakBonus;
  const final = Math.round(raw * entry.zone_multiplier);
  return { base, timeBonus, distBonus, streakBonus, raw, multiplier: entry.zone_multiplier, final };
}

function checkReaperStreak(data, idx) {
  const current = new Date(data[idx].date);
  const cutoff = new Date(current);
  cutoff.setDate(cutoff.getDate() - 7);
  return data.filter((d, i) => i !== idx && new Date(d.date) >= cutoff && new Date(d.date) <= current).length >= 2;
}

function calcLongestStreak(data) {
  if (data.length === 0) return 0;
  const sorted = [...data].sort((a, b) => new Date(a.date) - new Date(b.date));
  let longest = 1, current = 1;
  for (let i = 1; i < sorted.length; i++) {
    const diffDays = (new Date(sorted[i].date) - new Date(sorted[i-1].date)) / (1000*60*60*24);
    if (diffDays <= 7) { current++; longest = Math.max(longest, current); }
    else { current = 1; }
  }
  return longest;
}

/* ─── CALIBRATION COACHING ─── */
function getCalibrationAdvice(scoutData) {
  const avgBias = scoutData.reduce((s, e) => s + e.bias_direction, 0) / scoutData.length;
  const absBias = Math.abs(avgBias);
  const rounded = Math.abs(Math.round(avgBias * 10) / 10);
  if (absBias < 0.5) {
    return { tone: "sharp", color: "#3D6B4B", icon: "\uD83C\uDFAF", headline: "Well-calibrated.",
      body: "Your ratings track closely with validated results. Keep trusting your eye." };
  } else if (avgBias < 0) {
    return { tone: "harsh", color: "#9B5E3C", icon: "\uD83D\uDD0D", headline: "You tend to rate ~" + rounded + " points stricter than consensus.",
      body: "Your eye catches more than average \u2014 that\u2019s useful, but it\u2019s costing you accuracy XP. Next time, go with your gut, then nudge your scores up by about " + rounded + ". Trust the first instinct." };
  } else {
    return { tone: "lenient", color: "#A8872B", icon: "\uD83D\uDC41\uFE0F", headline: "You tend to overlook ~" + rounded + " points of impact.",
      body: "You\u2019re rating conditions about " + rounded + " points more favorably than validated results. Slow down on your weaker categories and look twice \u2014 the gap is usually hiding in plain sight." };
  }
}

/* ─── COLORS ─── */
const C = {
  parchment: "#F5EDD6", parchmentDeep: "#EDE3C6", cream: "#FBF7EC",
  bark: "#5C4A2E", barkLight: "#7D6842",
  forest: "#3D6B4B", forestLight: "#5A8F6A", forestPale: "#E8F0E6", moss: "#7BA06E",
  copper: "#9B5E3C", copperLight: "#C4835B", copperPale: "#F3E8DD",
  gold: "#A8872B", goldLight: "#C9A84C",
  ink: "#3A3225", inkMid: "#6B5F4D", inkLight: "#9C8F78",
  divider: "rgba(92,74,46,0.15)",
  cardBg: "rgba(255,255,255,0.55)", cardBorder: "rgba(92,74,46,0.12)",
};

/* ─── SHARED COMPONENTS ─── */
const ShieldIcon = ({ color = C.forest, size = 28 }) => (
  React.createElement("svg", { width: size, height: size*32/28, viewBox: "0 0 28 32", fill: "none" },
    React.createElement("path", { d: "M14 0L28 6V16C28 24.8 21.7 30.2 14 32C6.3 30.2 0 24.8 0 16V6L14 0Z", fill: color, fillOpacity: "0.12", stroke: color, strokeWidth: "1.5" }),
    React.createElement("path", { d: "M14 4L24 8.5V16C24 22.4 19.2 27 14 28.5C8.8 27 4 22.4 4 16V8.5L14 4Z", fill: color, fillOpacity: "0.06" })
  )
);

const SwordIcon = ({ color = C.copper, size = 28 }) => (
  <svg width={size} height={size*32/28} viewBox="0 0 28 32" fill="none">
    <path d="M14 0L16 20H12L14 0Z" fill={color} fillOpacity="0.6" stroke={color} strokeWidth="0.5"/>
    <path d="M8 20H20V22H8V20Z" fill={color}/><path d="M12 22H16V30H12V22Z" fill={color} fillOpacity="0.4"/>
    <circle cx="14" cy="31" r="1" fill={color}/>
  </svg>
);

const XPBar = ({ current, max, color = C.forest, label }) => {
  const pct = Math.min((current / max) * 100, 100);
  return (
    <div style={{ marginBottom: 8 }}>
      {label && <div style={{ fontSize: 11, color: C.inkLight, marginBottom: 3, fontFamily: "'Crimson Text', serif" }}>{label}</div>}
      <div style={{ background: "rgba(92,74,46,0.08)", borderRadius: 6, height: 16, overflow: "hidden", border: "1px solid " + C.divider }}>
        <div style={{ width: pct + "%", height: "100%", background: "linear-gradient(90deg, " + color + "55, " + color + ")", borderRadius: 5, transition: "width 0.8s ease" }}/>
      </div>
    </div>
  );
};

const StatBox = ({ label, value, unit, accent = C.gold }) => (
  <div style={{
    background: C.cardBg, border: "1px solid " + C.cardBorder,
    borderRadius: 8, padding: "10px 12px", textAlign: "center", minWidth: 70, flex: "1 1 0"
  }}>
    <div style={{ fontSize: 20, fontWeight: 700, color: accent, fontFamily: "'Cinzel', serif" }}>
      {value}<span style={{ fontSize: 10, color: C.inkLight, marginLeft: 2 }}>{unit}</span>
    </div>
    <div style={{ fontSize: 9, color: C.inkMid, fontFamily: "'Crimson Text', serif", textTransform: "uppercase", letterSpacing: 1, marginTop: 2 }}>{label}</div>
  </div>
);

const BreakdownRow = ({ label, value, accent, bold }) => (
  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "2px 0" }}>
    <span style={{ fontSize: 12, color: C.inkMid, fontFamily: "'Crimson Text', serif" }}>{label}</span>
    <span style={{ fontSize: bold ? 14 : 12, fontWeight: bold ? 700 : 400, color: accent || C.bark, fontFamily: "'Cinzel', serif" }}>
      {typeof value === "number" ? "+" + value : value}
    </span>
  </div>
);

const DivDot = ({ divergence }) => {
  const color = divergence <= 2 ? C.forest : divergence <= 4 ? C.gold : C.copper;
  return <div style={{ width: 8, height: 8, borderRadius: "50%", background: color, flexShrink: 0, display: "inline-block" }}/>;
};

const MultBadge = ({ multiplier }) => {
  if (multiplier <= 1) return null;
  return (
    <span style={{ fontSize: 9, color: C.gold, background: C.goldLight + "18", padding: "1px 5px", borderRadius: 3, fontFamily: "'Cinzel', serif", fontWeight: 700, marginLeft: 4 }}>
      {"×" + multiplier}
    </span>
  );
};

const EntryCard = ({ entry, xp, type, isExpanded, onToggle }) => {
  const classColor = type === "scout" ? C.forest : C.copper;
  return (
    <div onClick={onToggle} style={{
      background: C.cardBg, border: "1px solid " + C.cardBorder,
      borderRadius: 10, padding: "12px 16px", marginBottom: 8, cursor: "pointer",
      borderLeft: "3px solid " + (entry.zone ? classColor : C.inkLight)
    }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
        <div>
          <div style={{ fontSize: 14, color: C.bark, fontFamily: "'Crimson Text', serif", fontWeight: 600 }}>{entry.location}</div>
          <div style={{ fontSize: 11, color: C.inkLight, marginTop: 2 }}>{entry.date} · {entry.zone || "Unsponsored"}</div>
        </div>
        <div style={{ textAlign: "right" }}>
          <div style={{ fontSize: 20, fontWeight: 700, color: C.gold, fontFamily: "'Cinzel', serif" }}>+{xp.final}</div>
          <div style={{ fontSize: 10, color: C.inkLight }}>XP</div>
        </div>
      </div>
      {isExpanded && (
        <div style={{ marginTop: 12, paddingTop: 12, borderTop: "1px solid " + C.divider, animation: "fadeIn 0.3s ease" }}>
          <div style={{ fontSize: 11, color: C.inkMid, marginBottom: 8, textTransform: "uppercase", letterSpacing: 1 }}>XP Breakdown</div>
          <BreakdownRow label="Base" value={xp.base}/>
          {type === "scout" && <BreakdownRow label={"Accuracy (div: " + entry.divergence + ")"} value={xp.accuracyBonus} accent={xp.accuracyBonus > 20 ? C.forest : C.gold}/>}
          {type === "reaper" && (<>
            <BreakdownRow label={"Time (" + entry.duration_min + " min)"} value={xp.timeBonus}/>
            <BreakdownRow label={"Distance (" + entry.distance_mi + " mi)"} value={xp.distBonus}/>
            {xp.streakBonus > 0 && <BreakdownRow label="Streak (3+ / 7d)" value={xp.streakBonus} accent={C.forest}/>}
          </>)}
          <div style={{ borderTop: "1px solid " + C.divider, paddingTop: 4, marginTop: 4 }}>
            <BreakdownRow label="Subtotal" value={xp.raw}/>
            {xp.multiplier > 1 && <BreakdownRow label={"Zone (" + entry.zone + ")"} value={"×" + xp.multiplier} accent={C.gold}/>}
            <BreakdownRow label="Final XP" value={xp.final} accent={C.gold} bold/>
          </div>
        </div>
      )}
    </div>
  );
};

const DataBoundaryBanner = () => (
  <div style={{
    background: "linear-gradient(90deg, " + C.forestPale + ", " + C.copperPale + ")",
    border: "1px solid rgba(61,107,75,0.2)", borderRadius: 10,
    padding: "12px 16px", marginBottom: 20, display: "flex", alignItems: "center", gap: 12
  }}>
    <div style={{ display: "flex", alignItems: "center", gap: 6, flexShrink: 0 }}>
      <span style={{ fontSize: 12, color: C.forest, fontFamily: "'Cinzel', serif", fontWeight: 700 }}>CHIMERA</span>
      <svg width="36" height="16" viewBox="0 0 36 16">
        <defs><linearGradient id="ag" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stopColor={C.forest}/><stop offset="100%" stopColor={C.gold}/></linearGradient></defs>
        <path d="M0 8H28M28 8L22 3M28 8L22 13" stroke="url(#ag)" strokeWidth="2" fill="none"/>
      </svg>
      <span style={{ fontSize: 12, color: C.gold, fontFamily: "'Cinzel', serif", fontWeight: 700 }}>GONE FERAL</span>
    </div>
    <div style={{ fontSize: 11, color: C.inkMid, fontFamily: "'Crimson Text', serif" }}>
      Validation_Results handoff. CHIMERA writes, GF reads.
    </div>
  </div>
);

/* ─── LEDGER DETAIL PANEL ─── */
const DetailRow = ({ label, detail, xp, accent }) => (
  <div style={{
    display: "grid", gridTemplateColumns: "1fr 80px 80px",
    padding: "6px 12px", borderBottom: "1px solid rgba(92,74,46,0.06)"
  }}>
    <div style={{ fontSize: 12, color: C.bark }}>{label}</div>
    <div style={{ textAlign: "right", fontSize: 11, color: C.inkLight, alignSelf: "center" }}>{detail !== "\u2014" ? detail : ""}</div>
    <div style={{ textAlign: "right", fontSize: 13, color: accent || C.bark, fontFamily: "'Cinzel', serif", fontWeight: 600, alignSelf: "center" }}>+{xp}</div>
  </div>
);

const LedgerDetailPanel = ({ selected, allData }) => {
  if (!selected) {
    return (
      <div style={{
        background: "linear-gradient(135deg, rgba(92,74,46,0.03), rgba(61,107,75,0.03))",
        border: "1px dashed " + C.divider, borderRadius: 10,
        padding: "24px 16px", textAlign: "center", marginBottom: 16
      }}>
        <div style={{ fontSize: 13, color: C.inkLight, fontFamily: "'Crimson Text', serif", fontStyle: "italic" }}>
          Select an entry below to inspect its full XP breakdown
        </div>
      </div>
    );
  }
  const item = allData.find(d => d.id === selected);
  if (!item) return null;
  const isScout = item.type === "scout";
  const classColor = isScout ? C.forest : C.copper;
  const classLabel = isScout ? "Scout" : "Reaper";

  return (
    <div style={{
      background: C.cardBg, border: "1px solid " + classColor + "33",
      borderRadius: 10, padding: 16, marginBottom: 16,
      borderTop: "3px solid " + classColor, animation: "fadeIn 0.25s ease"
    }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 14 }}>
        <div>
          <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 4 }}>
            {isScout ? <ShieldIcon color={classColor} size={18}/> : <SwordIcon color={classColor} size={18}/>}
            <span style={{ fontSize: 14, fontWeight: 700, color: C.bark, fontFamily: "'Cinzel', serif" }}>{classLabel}</span>
            <span style={{ fontSize: 11, color: classColor, fontFamily: "monospace", background: classColor + "11", padding: "1px 6px", borderRadius: 3 }}>{item.id}</span>
          </div>
          <div style={{ fontSize: 13, color: C.bark, fontFamily: "'Crimson Text', serif", fontWeight: 600 }}>{item.entry.location}</div>
          <div style={{ fontSize: 11, color: C.inkLight, marginTop: 2 }}>{item.entry.date}</div>
        </div>
        <div style={{ textAlign: "right" }}>
          <div style={{ fontSize: 28, fontWeight: 700, color: C.gold, fontFamily: "'Cinzel', serif", lineHeight: 1 }}>+{item.xp.final}</div>
          <div style={{ fontSize: 10, color: C.inkLight, marginTop: 2 }}>FINAL XP</div>
        </div>
      </div>
      <div style={{ background: "rgba(92,74,46,0.03)", borderRadius: 8, overflow: "hidden", border: "1px solid " + C.divider }}>
        <div style={{
          display: "grid", gridTemplateColumns: "1fr 80px 80px",
          padding: "8px 12px", borderBottom: "1px solid " + C.divider,
          fontSize: 10, color: C.inkMid, textTransform: "uppercase", letterSpacing: 1, fontFamily: "'Cinzel', serif"
        }}>
          <div>Component</div><div style={{ textAlign: "right" }}>Detail</div><div style={{ textAlign: "right" }}>XP</div>
        </div>
        <DetailRow label="Base XP" detail="\u2014" xp={item.xp.base}/>
        {isScout && <DetailRow label="Accuracy Bonus" detail={"Div " + item.entry.divergence + "/10"} xp={item.xp.accuracyBonus} accent={item.xp.accuracyBonus > 20 ? C.forest : undefined}/>}
        {!isScout && (<>
          <DetailRow label="Time Bonus" detail={item.entry.duration_min + "m (cap 60)"} xp={item.xp.timeBonus}/>
          <DetailRow label="Distance Bonus" detail={item.entry.distance_mi + "mi ×20 (cap 40)"} xp={item.xp.distBonus}/>
          {item.xp.streakBonus > 0 && <DetailRow label="Streak Bonus" detail="3+ / 7d" xp={item.xp.streakBonus} accent={C.forest}/>}
        </>)}
        <div style={{ display: "grid", gridTemplateColumns: "1fr 80px 80px", padding: "8px 12px", borderTop: "1px solid " + C.divider, background: "rgba(92,74,46,0.03)" }}>
          <div style={{ fontSize: 12, color: C.inkMid, fontWeight: 600 }}>Subtotal</div><div></div>
          <div style={{ textAlign: "right", fontSize: 13, fontWeight: 600, color: C.bark, fontFamily: "'Cinzel', serif" }}>+{item.xp.raw}</div>
        </div>
        <div style={{
          display: "grid", gridTemplateColumns: "1fr 80px 80px",
          padding: "8px 12px", borderTop: "1px solid " + C.divider,
          background: item.xp.multiplier > 1 ? C.goldLight + "08" : "transparent"
        }}>
          <div>
            <div style={{ fontSize: 12, color: item.xp.multiplier > 1 ? C.gold : C.inkLight, fontWeight: 600 }}>Zone Multiplier</div>
            <div style={{ fontSize: 10, color: C.inkLight, marginTop: 1 }}>{item.entry.zone || "No active zone"}</div>
          </div>
          <div style={{ textAlign: "right", fontSize: 13, color: item.xp.multiplier > 1 ? C.gold : C.inkLight, fontFamily: "'Cinzel', serif", fontWeight: 600, alignSelf: "center" }}>{"×" + item.xp.multiplier}</div>
          <div style={{ textAlign: "right", fontSize: 13, color: C.inkLight, fontFamily: "'Cinzel', serif", alignSelf: "center" }}>
            {item.xp.multiplier > 1 ? "+" + (item.xp.final - item.xp.raw) : "\u2014"}
          </div>
        </div>
        <div style={{
          display: "grid", gridTemplateColumns: "1fr 80px 80px",
          padding: "10px 12px", borderTop: "2px solid " + classColor + "33", background: classColor + "08"
        }}>
          <div style={{ fontSize: 13, color: C.bark, fontFamily: "'Cinzel', serif", fontWeight: 700 }}>Final XP Awarded</div><div></div>
          <div style={{ textAlign: "right", fontSize: 16, fontWeight: 700, color: C.gold, fontFamily: "'Cinzel', serif" }}>+{item.xp.final}</div>
        </div>
      </div>
    </div>
  );
};

const RadioDot = ({ selected, color }) => (
  <div style={{
    width: 18, height: 18, borderRadius: "50%",
    border: "2px solid " + (selected ? color : C.inkLight),
    display: "flex", alignItems: "center", justifyContent: "center",
    transition: "all 0.15s", cursor: "pointer", flexShrink: 0
  }}>
    {selected && <div style={{ width: 10, height: 10, borderRadius: "50%", background: color }}/>}
  </div>
);

/* ─── MAIN APP ─── */
function GoneFeral() {
  const [activeTab, setActiveTab] = useState("hall");
  const [expandedEntry, setExpandedEntry] = useState(null);
  const [selectedLedgerEntry, setSelectedLedgerEntry] = useState(null);
  const [mounted, setMounted] = useState(false);
  useEffect(() => { setMounted(true); }, []);

  const scoutXPs = CHIMERA_SCOUT_DATA.map(e => ({ entry: e, xp: calcScoutXP(e), type: "scout", id: e.id }));
  const reaperXPs = CHIMERA_REAPER_DATA.map((e, i) => ({ entry: e, xp: calcReaperXP(e, checkReaperStreak(CHIMERA_REAPER_DATA, i)), type: "reaper", id: e.id }));
  const allData = [...scoutXPs, ...reaperXPs].sort((a, b) => new Date(b.entry.date) - new Date(a.entry.date));

  const totalScoutXP = scoutXPs.reduce((s, x) => s + x.xp.final, 0);
  const totalReaperXP = reaperXPs.reduce((s, x) => s + x.xp.final, 0);
  const totalXP = totalScoutXP + totalReaperXP;
  const scoutLevel = Math.floor(totalScoutXP / 150) + 1;
  const reaperLevel = Math.floor(totalReaperXP / 150) + 1;
  const overallLevel = Math.floor(totalXP / 300) + 1;

  const totalLbs = CHIMERA_REAPER_DATA.reduce((s, e) => s + e.weight_lbs, 0);
  const totalMiles = CHIMERA_REAPER_DATA.reduce((s, e) => s + e.distance_mi, 0);
  const longestStreak = calcLongestStreak(CHIMERA_REAPER_DATA);
  const totalCollections = allData.length;
  const calibration = getCalibrationAdvice(CHIMERA_SCOUT_DATA);

  const tabs = [
    { id: "hall", label: "Hall" },
    { id: "ledger", label: "Ledger" },
    { id: "maps", label: "Maps" },
    { id: "scout", label: "Scout" },
    { id: "reaper", label: "Reaper" },
  ];

  return (
    <div style={{
      minHeight: "100vh",
      background: "linear-gradient(175deg, " + C.cream + " 0%, " + C.parchment + " 35%, " + C.parchmentDeep + " 100%)",
      color: C.bark, fontFamily: "'Crimson Text', serif",
      opacity: mounted ? 1 : 0, transition: "opacity 0.6s ease"
    }}>
      <div style={{ height: 4, background: "linear-gradient(90deg, " + C.forest + "00, " + C.forest + "66, " + C.moss + "88, " + C.forest + "66, " + C.forest + "00)" }}/>

      {/* Header */}
      <div style={{ padding: "28px 20px 0", textAlign: "center", background: "linear-gradient(180deg, rgba(61,107,75,0.06) 0%, transparent 100%)" }}>
        <div style={{ fontSize: 10, textTransform: "uppercase", letterSpacing: 4, color: C.moss, marginBottom: 6 }}>The Wilds Beckon</div>
        <h1 style={{ fontFamily: "'Cinzel', serif", fontSize: 30, fontWeight: 700, color: C.forest, letterSpacing: 3, marginBottom: 4, textShadow: "0 1px 0 rgba(255,255,255,0.6)" }}>GONE FERAL</h1>
        <div style={{ fontSize: 13, color: C.inkMid }}>Level {overallLevel} · {totalXP} Total XP</div>
        <div style={{ display: "flex", alignItems: "center", justifyContent: "center", gap: 8, margin: "14px 0 0" }}>
          <div style={{ width: 40, height: 1, background: "linear-gradient(90deg, transparent, " + C.goldLight + ")" }}/>
          <div style={{ width: 6, height: 6, borderRadius: "50%", border: "1.5px solid " + C.goldLight, background: C.cream }}/>
          <div style={{ width: 40, height: 1, background: "linear-gradient(90deg, " + C.goldLight + ", transparent)" }}/>
        </div>
      </div>

      {/* Nav */}
      <div style={{ display: "flex", gap: 0, padding: "12px 16px 0", borderBottom: "1px solid " + C.divider, overflowX: "auto" }}>
        {tabs.map(tab => (
          <button key={tab.id} onClick={() => { setActiveTab(tab.id); setExpandedEntry(null); }}
            style={{
              flex: "1 0 auto", padding: "10px 8px", border: "none", cursor: "pointer",
              background: activeTab === tab.id ? "rgba(61,107,75,0.06)" : "transparent",
              color: activeTab === tab.id ? C.forest : C.inkLight,
              fontFamily: "'Cinzel', serif", fontSize: 11, fontWeight: 600,
              letterSpacing: 1, textTransform: "uppercase",
              borderBottom: activeTab === tab.id ? "2px solid " + C.forest : "2px solid transparent",
              transition: "all 0.2s", whiteSpace: "nowrap"
            }}
          >{tab.label}</button>
        ))}
      </div>

      {/* Content */}
      <div style={{ padding: "20px", maxWidth: 600, margin: "0 auto" }}>
        <DataBoundaryBanner/>

        {/* ═══ HALL ═══ */}
        {activeTab === "hall" && (
          <div style={{ animation: "fadeIn 0.4s ease" }}>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 20 }}>
              <div onClick={() => setActiveTab("scout")} style={{
                background: "linear-gradient(145deg, " + C.forestPale + ", " + C.cardBg + ")",
                border: "1px solid rgba(61,107,75,0.18)", borderRadius: 12, padding: 16, cursor: "pointer", position: "relative", overflow: "hidden"
              }}>
                <div style={{ position: "absolute", top: 12, right: 12, opacity: 0.35 }}><ShieldIcon/></div>
                <div style={{ fontSize: 10, textTransform: "uppercase", letterSpacing: 2, color: C.forest, marginBottom: 4, fontWeight: 700 }}>Scout</div>
                <div style={{ fontFamily: "'Cinzel', serif", fontSize: 18, fontWeight: 700, color: C.bark, marginBottom: 2 }}>Lvl {scoutLevel}</div>
                <div style={{ fontSize: 12, color: C.inkMid, marginBottom: 10 }}>{totalScoutXP} / {scoutLevel * 150} XP</div>
                <XPBar current={totalScoutXP % 150} max={150} color={C.forest}/>
                <div style={{ fontSize: 10, color: C.forest, marginTop: 8, padding: "3px 8px", background: "rgba(61,107,75,0.08)", borderRadius: 4, display: "inline-block", fontWeight: 600 }}>← Rate a Location</div>
              </div>
              <div onClick={() => setActiveTab("reaper")} style={{
                background: "linear-gradient(145deg, " + C.copperPale + ", " + C.cardBg + ")",
                border: "1px solid rgba(155,94,60,0.18)", borderRadius: 12, padding: 16, cursor: "pointer", position: "relative", overflow: "hidden"
              }}>
                <div style={{ position: "absolute", top: 12, right: 12, opacity: 0.35 }}><SwordIcon/></div>
                <div style={{ fontSize: 10, textTransform: "uppercase", letterSpacing: 2, color: C.copper, marginBottom: 4, fontWeight: 700 }}>Reaper</div>
                <div style={{ fontFamily: "'Cinzel', serif", fontSize: 18, fontWeight: 700, color: C.bark, marginBottom: 2 }}>Lvl {reaperLevel}</div>
                <div style={{ fontSize: 12, color: C.inkMid, marginBottom: 10 }}>{totalReaperXP} / {reaperLevel * 150} XP</div>
                <XPBar current={totalReaperXP % 150} max={150} color={C.copper}/>
                <div style={{ fontSize: 10, color: C.copper, marginTop: 8, padding: "3px 8px", background: "rgba(155,94,60,0.08)", borderRadius: 4, display: "inline-block", fontWeight: 600 }}>← Collect Litter</div>
              </div>
            </div>

            <div style={{ fontSize: 11, textTransform: "uppercase", letterSpacing: 2, color: C.inkMid, marginBottom: 12, fontFamily: "'Cinzel', serif" }}>Recent Dispatches</div>
            {allData.slice(0, 5).map((item, i) => {
              const isScout = item.type === "scout";
              const classColor = isScout ? C.forest : C.copper;
              return (
                <div key={i} style={{
                  background: C.cardBg, borderRadius: 8, marginBottom: 6,
                  borderLeft: "3px solid " + classColor,
                  border: "1px solid " + C.cardBorder, padding: "10px 14px"
                }}>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
                    <div style={{ flex: 1 }}>
                      <div style={{ fontSize: 13, color: C.bark, fontWeight: 600, display: "flex", alignItems: "center", gap: 6 }}>
                        {item.entry.location}
                        {item.entry.zone && (
                          <span style={{ fontSize: 9, color: C.gold, background: C.goldLight + "15", padding: "1px 5px", borderRadius: 3, fontWeight: 700, fontFamily: "'Cinzel', serif" }}>
                            {item.entry.zone.split(" ")[0]}
                          </span>
                        )}
                      </div>
                      <div style={{ fontSize: 11, color: C.inkLight, marginTop: 3, display: "flex", alignItems: "center", gap: 6, flexWrap: "wrap" }}>
                        <span style={{ fontSize: 9, fontWeight: 700, color: classColor, background: classColor + "11", padding: "1px 5px", borderRadius: 3, fontFamily: "'Cinzel', serif" }}>
                          {isScout ? "SCT" : "RPR"}
                        </span>
                        <span>{item.entry.date}</span>
                        {isScout && (<>
                          <span style={{ color: C.divider }}>·</span>
                          <span style={{ display: "inline-flex", alignItems: "center", gap: 3 }}><DivDot divergence={item.entry.divergence}/> div {item.entry.divergence}</span>
                          <span style={{ color: C.divider }}>·</span>
                          <span>{item.entry.categories_rated}/{item.entry.total_categories} cats</span>
                        </>)}
                        {!isScout && (<>
                          <span style={{ color: C.divider }}>·</span>
                          <span>{item.entry.duration_min}m</span>
                          <span style={{ color: C.divider }}>·</span>
                          <span>{item.entry.distance_mi} mi</span>
                          <span style={{ color: C.divider }}>·</span>
                          <span>{item.entry.weight_lbs} lbs</span>
                        </>)}
                      </div>
                    </div>
                    <div style={{ textAlign: "right", flexShrink: 0, marginLeft: 10 }}>
                      <div style={{ display: "flex", alignItems: "center", justifyContent: "flex-end" }}>
                        <span style={{ fontSize: 16, fontWeight: 700, color: C.gold, fontFamily: "'Cinzel', serif" }}>+{item.xp.final}</span>
                        <MultBadge multiplier={item.xp.multiplier}/>
                      </div>
                      <div style={{ fontSize: 9, color: C.inkLight }}>XP</div>
                    </div>
                  </div>
                </div>
              );
            })}
            <div style={{ display: "flex", gap: 8, marginTop: 16 }}>
              <StatBox label="Total XP" value={totalXP}/>
              <StatBox label="Collections" value={totalCollections}/>
              <StatBox label="Total Lbs" value={totalLbs.toFixed(1)} accent={C.copper}/>
            </div>
          </div>
        )}

        {/* ═══ LEDGER ═══ */}
        {activeTab === "ledger" && (
          <div style={{ animation: "fadeIn 0.4s ease" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 16 }}>
              <div style={{ fontSize: 24 }}>{"\uD83D\uDCDC"}</div>
              <div>
                <h2 style={{ fontFamily: "'Cinzel', serif", fontSize: 20, color: C.bark, fontWeight: 700 }}>XP Ledger</h2>
                <div style={{ fontSize: 12, color: C.inkLight }}>Daily batch · 3:00 AM CST · Select an entry to inspect</div>
              </div>
            </div>
            <LedgerDetailPanel selected={selectedLedgerEntry} allData={allData}/>
            <div style={{ background: C.cardBg, border: "1px solid " + C.cardBorder, borderRadius: 10, overflow: "hidden" }}>
              <div style={{
                display: "grid", gridTemplateColumns: "32px 70px 1fr 54px 50px 54px",
                padding: "10px 10px", background: "rgba(61,107,75,0.05)",
                borderBottom: "1px solid " + C.divider,
                fontSize: 9, color: C.inkMid, textTransform: "uppercase", letterSpacing: 1, fontFamily: "'Cinzel', serif", alignItems: "center"
              }}>
                <div></div><div>Date</div><div>Source</div><div style={{ textAlign: "center" }}>Class</div><div style={{ textAlign: "right" }}>Raw</div><div style={{ textAlign: "right" }}>Final</div>
              </div>
              {allData.map((item, i) => {
                const isSelected = selectedLedgerEntry === item.id;
                const clColor = item.type === "scout" ? C.forest : C.copper;
                return (
                  <div key={item.id} onClick={() => setSelectedLedgerEntry(isSelected ? null : item.id)}
                    style={{
                      display: "grid", gridTemplateColumns: "32px 70px 1fr 54px 50px 54px",
                      padding: "9px 10px", borderBottom: "1px solid " + C.divider,
                      fontSize: 12, color: C.bark, fontFamily: "'Crimson Text', serif",
                      background: isSelected ? clColor + "0C" : i % 2 === 0 ? "transparent" : "rgba(92,74,46,0.02)",
                      cursor: "pointer", alignItems: "center", transition: "background 0.15s"
                    }}>
                    <div style={{ display: "flex", justifyContent: "center" }}><RadioDot selected={isSelected} color={clColor}/></div>
                    <div style={{ color: C.inkMid, fontSize: 11 }}>{item.entry.date.slice(5)}</div>
                    <div style={{ fontFamily: "monospace", fontSize: 10, color: C.inkMid, overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }}>{item.id}</div>
                    <div style={{ textAlign: "center" }}>
                      <span style={{ fontSize: 10, fontWeight: 700, color: clColor, background: clColor + "11", padding: "2px 6px", borderRadius: 3, fontFamily: "'Cinzel', serif" }}>
                        {item.type === "scout" ? "SCT" : "RPR"}
                      </span>
                    </div>
                    <div style={{ textAlign: "right", color: C.inkMid, fontSize: 11 }}>{item.xp.raw}</div>
                    <div style={{ textAlign: "right", color: C.gold, fontWeight: 700, fontFamily: "'Cinzel', serif" }}>+{item.xp.final}</div>
                  </div>
                );
              })}
              <div style={{
                display: "grid", gridTemplateColumns: "32px 70px 1fr 54px 50px 54px",
                padding: "10px 10px", background: "rgba(61,107,75,0.05)",
                borderTop: "1px solid rgba(61,107,75,0.15)",
                fontSize: 12, fontWeight: 700, fontFamily: "'Cinzel', serif", alignItems: "center"
              }}>
                <div></div><div></div><div style={{ color: C.inkMid }}>TOTAL</div><div></div><div></div>
                <div style={{ textAlign: "right", color: C.gold, fontSize: 14 }}>+{totalXP}</div>
              </div>
            </div>
            <div style={{
              marginTop: 16, padding: 12, background: "rgba(92,74,46,0.04)",
              borderRadius: 8, border: "1px solid " + C.divider, fontSize: 11, color: C.inkMid, lineHeight: 1.5
            }}>
              <strong style={{ color: C.bark }}>Schema:</strong> entry_id, user_id, source_class (Scout|Reaper), chimera_ref_id, base_xp, bonus_breakdown (JSON), zone_multiplier, final_xp, batch_date, created_at
            </div>
          </div>
        )}

        {/* ═══ MAPS ═══ */}
        {activeTab === "maps" && (
          <div style={{ animation: "fadeIn 0.4s ease", textAlign: "center", padding: "40px 20px" }}>
            <div style={{ fontSize: 48, marginBottom: 16, opacity: 0.4 }}>{"\uD83D\uDDFA\uFE0F"}</div>
            <h2 style={{ fontFamily: "'Cinzel', serif", fontSize: 22, color: C.bark, fontWeight: 700, marginBottom: 8 }}>The Cartographer's Table</h2>
            <div style={{ fontSize: 14, color: C.inkMid, maxWidth: 340, margin: "0 auto", lineHeight: 1.6 }}>
              Zone boundaries, merchant territories, and activity heatmaps will be charted here.
            </div>
            <div style={{
              marginTop: 24, display: "inline-flex", flexDirection: "column", gap: 8,
              background: C.cardBg, border: "1px solid " + C.cardBorder, borderRadius: 10, padding: "16px 24px", textAlign: "left"
            }}>
              <div style={{ fontSize: 11, color: C.inkMid, textTransform: "uppercase", letterSpacing: 1, fontFamily: "'Cinzel', serif", marginBottom: 4 }}>Planned Layers</div>
              {["Merchant Zone Boundaries", "XP Multiplier Overlays", "Activity Heatmap (Scout + Reaper)", "Sponsored Zone Indicators", "Cooldown Radius Display"].map((item, i) => (
                <div key={i} style={{ fontSize: 12, color: C.inkLight, display: "flex", alignItems: "center", gap: 8 }}>
                  <div style={{ width: 6, height: 6, borderRadius: "50%", border: "1.5px solid " + C.moss, flexShrink: 0 }}/>
                  {item}
                </div>
              ))}
            </div>
          </div>
        )}

        {/* ═══ SCOUT ═══ */}
        {activeTab === "scout" && (
          <div style={{ animation: "fadeIn 0.4s ease" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 16 }}>
              <ShieldIcon color={C.forest}/>
              <div>
                <h2 style={{ fontFamily: "'Cinzel', serif", fontSize: 20, color: C.bark, fontWeight: 700 }}>Scout</h2>
                <div style={{ fontSize: 12, color: C.forest }}>Eyes of the Wild · Mirrors CHIMERA "Rate a Location"</div>
              </div>
            </div>
            <div style={{ background: C.forestPale, border: "1px solid rgba(61,107,75,0.2)", borderRadius: 10, padding: 14, marginBottom: 16 }}>
              <div style={{ fontSize: 11, color: C.forest, fontFamily: "'Cinzel', serif", textTransform: "uppercase", letterSpacing: 1, marginBottom: 8, fontWeight: 700 }}>XP Formula</div>
              <div style={{ fontSize: 13, color: C.bark, lineHeight: 1.6 }}>
                <strong>50</strong> base + <strong>Accuracy Bonus</strong> (0–25, scaled by Divergence 0–10) × Merchant Zone Multiplier
              </div>
            </div>
            <div style={{ display: "flex", gap: 8, marginBottom: 16 }}>
              <StatBox label="Level" value={scoutLevel} accent={C.forest}/>
              <StatBox label="Total XP" value={totalScoutXP}/>
              <StatBox label="Avg Div" value={(scoutXPs.reduce((s, x) => s + x.entry.divergence, 0) / scoutXPs.length).toFixed(1)} accent={C.forest}/>
            </div>

            {/* Calibration coaching */}
            <div style={{
              background: calibration.color + "0A",
              border: "1px solid " + calibration.color + "25",
              borderRadius: 10, padding: 14, marginBottom: 16,
              borderLeft: "4px solid " + calibration.color
            }}>
              <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 8 }}>
                <span style={{ fontSize: 20 }}>{calibration.icon}</span>
                <div style={{ fontSize: 13, color: C.bark, fontWeight: 600 }}>{calibration.headline}</div>
              </div>
              <div style={{ fontSize: 12, color: C.inkMid, lineHeight: 1.6, paddingLeft: 28 }}>
                {calibration.body}
              </div>
              <div style={{ marginTop: 10, paddingLeft: 28, fontSize: 10, color: C.inkLight, fontStyle: "italic" }}>
                Based on signed bias from CHIMERA Activity Feed (Over/Under validation). Avg bias: {(CHIMERA_SCOUT_DATA.reduce((s, e) => s + e.bias_direction, 0) / CHIMERA_SCOUT_DATA.length).toFixed(1)}
              </div>
            </div>

            <XPBar current={totalScoutXP % 150} max={150} color={C.forest} label={(totalScoutXP % 150) + " / 150 to Level " + (scoutLevel + 1)}/>
            <div style={{ fontSize: 11, textTransform: "uppercase", letterSpacing: 2, color: C.inkMid, margin: "20px 0 12px", fontFamily: "'Cinzel', serif" }}>Activity Log</div>
            {scoutXPs.map(item => (
              <EntryCard key={item.entry.id} entry={item.entry} xp={item.xp} type="scout"
                isExpanded={expandedEntry === item.entry.id}
                onToggle={() => setExpandedEntry(expandedEntry === item.entry.id ? null : item.entry.id)}/>
            ))}
          </div>
        )}

        {/* ═══ REAPER ═══ */}
        {activeTab === "reaper" && (
          <div style={{ animation: "fadeIn 0.4s ease" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 16 }}>
              <SwordIcon color={C.copper}/>
              <div>
                <h2 style={{ fontFamily: "'Cinzel', serif", fontSize: 20, color: C.bark, fontWeight: 700 }}>Reaper</h2>
                <div style={{ fontSize: 12, color: C.copper }}>Hands of the Reclaimer · Mirrors CHIMERA "Collect Litter"</div>
              </div>
            </div>
            <div style={{ background: C.copperPale, border: "1px solid rgba(155,94,60,0.2)", borderRadius: 10, padding: 14, marginBottom: 16 }}>
              <div style={{ fontSize: 11, color: C.copper, fontFamily: "'Cinzel', serif", textTransform: "uppercase", letterSpacing: 1, marginBottom: 8, fontWeight: 700 }}>XP Formula</div>
              <div style={{ fontSize: 13, color: C.bark, lineHeight: 1.6 }}>
                <strong>50</strong> base + <strong>Time</strong> (1/min, cap 60) + <strong>Distance</strong> (20/mi, cap 40) + <strong>Streak</strong> (15 for 3+ in 7d) × Zone Multiplier
              </div>
            </div>
            <div style={{ display: "flex", gap: 8, marginBottom: 16 }}>
              <StatBox label="Total Lbs" value={totalLbs.toFixed(1)} accent={C.copper}/>
              <StatBox label="Miles" value={totalMiles.toFixed(1)} accent={C.copper}/>
              <StatBox label="Best Streak" value={longestStreak} unit=" days" accent={C.forest}/>
            </div>
            <XPBar current={totalReaperXP % 150} max={150} color={C.copper} label={(totalReaperXP % 150) + " / 150 to Level " + (reaperLevel + 1)}/>
            <div style={{ fontSize: 11, textTransform: "uppercase", letterSpacing: 2, color: C.inkMid, margin: "20px 0 12px", fontFamily: "'Cinzel', serif" }}>Activity Log</div>
            {reaperXPs.map(item => (
              <EntryCard key={item.entry.id} entry={item.entry} xp={item.xp} type="reaper"
                isExpanded={expandedEntry === item.entry.id}
                onToggle={() => setExpandedEntry(expandedEntry === item.entry.id ? null : item.entry.id)}/>
            ))}
          </div>
        )}
      </div>

      <div style={{
        textAlign: "center", padding: "20px", marginTop: 20,
        borderTop: "1px solid " + C.divider,
        fontSize: 10, color: C.inkLight, fontFamily: "'Crimson Text', serif"
      }}>
        Gone Feral v0.3 · Prototype · Data sourced from CHIMERA Validation_Results
      </div>
    </div>
  );
}

ReactDOM.render(React.createElement(GoneFeral), document.getElementById("root"));
</script>
</body>
</html>
