<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CHIMERA - Unified Tracking V5.6</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <!-- ==================== SITE PAUSE OVERLAY ==================== -->
    <div class="site-pause-overlay" id="sitePauseOverlay">
        <div class="site-pause-content">
            <div class="site-pause-icon">üöß</div>
            <div class="site-pause-title">CHIMERA is Temporarily Unavailable</div>
            <div class="site-pause-message" id="sitePauseMessage">We'll be back soon.</div>
        </div>
    </div>

    <!-- ==================== HAMBURGER MENU ==================== -->
    <div class="menu-overlay" id="menuOverlay"></div>
    <div class="slide-menu" id="slideMenu">
        <div class="menu-header">
            <div class="menu-username" id="menuUsername">Volunteer</div>
            <div class="menu-edit" id="menuEditProfile">edit profile</div>
        </div>

        <!-- Event Coordinator Section (hidden by default) -->
        <div class="menu-section" id="coordinatorMenuSection" style="display: none;">
            <div class="menu-item" id="menuEventManager" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; margin: 4px 0;">
                <span class="menu-item-icon">‚≠ê</span>
                <span style="color: #92400e; font-weight: 600;">Event Manager</span>
            </div>
        </div>
        <div class="menu-divider" id="coordinatorDivider" style="display: none;"></div>

        <!-- Lockout Banner -->
        <div class="menu-lockout-banner" id="menuLockoutBanner">
            <div class="lockout-icon">üåô</div>
            <div class="lockout-title">Outdoor Tracking Unavailable</div>
            <div class="lockout-detail">Disabled after sunset for safety.<br>Next sunrise: <span id="menuLockoutSunrise">--:--</span></div>
        </div>

        <!-- ACTIONS -->
        <div class="menu-section-title" style="font-size: 11px; color: #6b7280; font-weight: 600; padding: 8px 16px 4px; text-transform: uppercase;">Actions</div>
        <div class="menu-section">
            <div class="menu-item" id="menuGettingStarted">
                <span class="menu-item-icon">üí°</span>
                <span>Getting Started</span>
            </div>
            <div class="menu-item" id="menuScout">
                <span class="menu-item-icon">üîç</span>
                <span>Rate Location</span>
            </div>
            <div class="menu-item disabled" id="menuPin">
                <span class="menu-item-icon">üìç</span>
                <span>Pin Location (coming soon)</span>
            </div>
            <div class="menu-item" id="menuTrack">
                <span class="menu-item-icon">üóëÔ∏è</span>
                <span>Live Track: ‚àöCPUE</span>
            </div>
            <div class="menu-item" id="menuRecycle">
                <span class="menu-item-icon">‚ôªÔ∏è</span>
                <span>Recycle</span>
            </div>
            <div class="menu-item disabled" id="menuCompost">
                <span class="menu-item-icon">üå±</span>
                <span>Composting (coming soon)</span>
            </div>
        </div>

        <div class="menu-divider"></div>

        <!-- INFORMATION -->
        <div class="menu-section-title" style="font-size: 11px; color: #6b7280; font-weight: 600; padding: 8px 16px 4px; text-transform: uppercase;">Information</div>
        <div class="menu-section">
            <div class="menu-item" id="menuActivityFeed">
                <span class="menu-item-icon">üìä</span>
                <span>Activity Feed</span>
            </div>
            <div class="menu-item" id="menuUpcomingEvents">
                <span class="menu-item-icon">üìÜ</span>
                <span>Upcoming Events</span>
            </div>
            <div class="menu-item" id="menuWiki">
                <span class="menu-item-icon">üìö</span>
                <span>CHIMERAwiki</span>
            </div>
            <div class="menu-item" id="menuFieldTest">
                <span class="menu-item-icon">üó∫Ô∏è</span>
                <span>Field Test Map</span>
            </div>
            <div class="menu-item" id="menuDemo">
                <span class="menu-item-icon">üêæ</span>
                <span>The Chimera Hunt Game (beta version)</span>
            </div>
            <div class="menu-item" id="menuFeedback">
                <span class="menu-item-icon">üí¨</span>
                <span>Send Feedback</span>
            </div>
        </div>

        <div class="menu-section" id="adminMenuSection" style="display: none;">
            <div class="menu-section-title" style="font-size: 11px; color: #6b7280; font-weight: 600; padding: 8px 16px 4px; text-transform: uppercase;">Admin</div>
            <div class="menu-item" id="menuAdmin">
                <span class="menu-item-icon">üîß</span>
                <span>Admin Dashboard <span class="menu-badge" id="adminMenuBadge" style="display:none;">0</span></span>
            </div>
        </div>

        <div class="menu-divider"></div>

        <div class="menu-section">
            <div class="menu-item" id="menuLogout">
                <span class="menu-item-icon">üö™</span>
                <span>Log Out</span>
            </div>
        </div>
    </div>

    <!-- ==================== TOAST NOTIFICATIONS ==================== -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <!-- ==================== HEADER ==================== -->
        <div class="header">
            <div class="hamburger hidden" id="hamburgerBtn">‚ò∞<span class="hamburger-badge hidden" id="hamburgerBadge">0</span></div>
            <div class="header-content">
                <h1>üåç CHIMERA Tracker</h1>
                <div class="subtitle">Data Hub for Litter Scouting, Collecting & Recycling ‚Ä¢ V5.6</div>
            </div>
        </div>

        <div class="content">
            <!-- ==================== LOGIN SCREEN ==================== -->
            <div id="loginScreen">

                <!-- LOGIN FORM (compact) -->
                <div class="login-card login-compact" id="loginForm">
                    <div class="login-compact-header">
                        <strong>üåç Welcome to CHIMERA!</strong>
                        <div class="login-sub">Log in or create a profile to start tracking.</div>
                    </div>
                    <div class="login-fields-row">
                        <div class="form-group login-field-handle">
                            <label class="form-label">Handle</label>
                            <input type="text" class="form-input" id="loginHandle" placeholder="Your handle" autocomplete="off">
                        </div>
                        <div class="form-group login-field-pin">
                            <label class="form-label">Password</label>
                            <div class="pin-input-wrapper">
                                <input type="password" class="form-input" id="loginPassword" placeholder="Enter password" autocomplete="off">
                                <span class="pin-toggle" onclick="togglePIN('loginPassword', this)">üëÅÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="loginBtn" disabled>Log In</button>
                    <div class="login-compact-footer">
                        <span class="login-help-text">Forgot password? Ask your org lead.</span>
                        <span class="login-toggle" id="showCreateToggle">New here? Create profile ‚Üí</span>
                    </div>
                </div>

                <!-- CREATE PROFILE FORM (compact) -->
                <div class="login-card login-compact hidden" id="createForm">
                    <div class="login-compact-header">
                        <strong>üìù Create Profile</strong>
                        <div class="login-sub">Choose a handle and password you'll remember.</div>
                    </div>
                    <div class="login-fields-row">
                        <div class="form-group login-field-handle">
                            <label class="form-label">Handle</label>
                            <input type="text" class="form-input" id="createHandle" placeholder="Pick a nickname" autocomplete="off">
                        </div>
                        <div class="form-group login-field-pin">
                            <label class="form-label">Password</label>
                            <div class="pin-input-wrapper">
                                <input type="password" class="form-input" id="createPassword" placeholder="8+ chars" autocomplete="off">
                                <span class="pin-toggle" onclick="togglePIN('createPassword', this)">üëÅÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    <div class="create-profile-hint">‚ö†Ô∏è Handle is public ‚Äî don't use your real name. Password must be 8+ characters.</div>
                    <div class="form-group">
                        <label class="form-label">Organization</label>
                        <select class="form-select" id="createOrgSelect">
                            <option value="">Select your organization</option>
                            <option value="Baled It!">Baled It!</option>
                            <option value="Help A Brother Out Foundation">Help A Brother Out Foundation</option>
                            <option value="West Montgomery Action Committee">West Montgomery Action Committee</option>
                            <option value="other">Add organization...</option>
                        </select>
                        <div class="custom-org-input" id="createCustomOrg">
                            <input type="text" class="form-input" id="createCustomOrgText" placeholder="Enter organization name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email (Optional)</label>
                        <input type="email" class="form-input" id="createEmail" placeholder="For event notifications only" autocomplete="off">
                        <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">üîí Never shared. Event notifications only.</div>
                    </div>
                    <button class="btn btn-primary" id="createProfileBtn" disabled>Create Profile</button>
                    <div class="login-compact-footer">
                        <span class="login-toggle" id="showLoginToggle">Already have a profile? Log in ‚Üí</span>
                    </div>
                </div>

                <!-- PUBLIC EVENTS (pre-login, no auth) -->
                <div class="public-events-collapsible" id="publicEventsSection">
                    <div class="public-events-header" id="publicEventsToggle">
                        <span class="public-events-title">üìÖ Upcoming Events <span class="public-events-count" id="publicEventsCount" style="display:none;">0</span></span>
                        <span class="public-events-chevron" id="publicEventsChevron">‚ñ∂</span>
                    </div>
                    <div class="public-events-body" id="publicEventsBody" style="display:none;">
                        <div id="publicEventsList">
                            <div style="text-align: center; color: #9ca3af; font-size: 13px; padding: 20px;">Loading events...</div>
                        </div>
                    </div>
                </div>

                <!-- PRE-LOGIN ACTIVITY FEED (hero) -->
                <div class="activity-feed" id="preLoginFeed">
                    <div class="feed-header">
                        <div class="feed-title"><span>üìä</span> Recent Activity</div>
                    </div>
                    <div class="feed-scroll" id="preLoginFeedScroll">
                        <div style="text-align: center; color: #9ca3af; font-size: 13px; padding: 40px 20px;">Loading activity...</div>
                    </div>
                </div>
            </div>

            <!-- ==================== MAIN SCREEN ==================== -->
            <div id="mainScreen" class="hidden">
                <div class="upcoming-events" id="upcomingEventsBanner" onclick="showUpcomingEvents()" style="cursor: pointer;">
                    üìÖ <span id="upcomingBannerText">Loading events...</span>
                </div>
                <div class="activity-feed">
                    <div class="feed-header">
                        <div class="feed-title"><span>üìä</span> Recent Activity</div>
                    </div>
                    <div class="feed-scroll" id="feedScroll">
                        <div style="text-align: center; color: #9ca3af; font-size: 13px; padding: 40px 20px;">Loading activity...</div>
                    </div>
                </div>
            </div>

            <!-- ==================== SCOUT MODE ==================== -->
            <div id="scoutScreen" class="hidden">
                <div class="instructions">
                    <strong>üîç Rate Location</strong><br>
                    Capture your GPS location and rate the litter density.
                </div>
                <div class="status-box">
                    <div class="status-row">
                        <span class="status-label">üìç Location</span>
                        <span class="status-value" id="scoutGPSStatus">Capturing...</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Litter Rating (0-10)</label>
                    <div class="rating-value untouched" id="scoutRatingValue">‚Äî</div>
                    <div class="rating-description" id="scoutRatingDesc">Tap the slider to rate</div>
                    <div class="rating-scale">
                        <span>0 - Clean</span><span>5 - Moderate</span><span>10 - Severe</span>
                    </div>
                    <input type="range" class="slider untouched" id="scoutRatingSlider" min="0" max="10" value="5" step="1">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea class="notes-textarea" id="scoutNotes" placeholder="Describe this location ‚Äî nearby landmarks, notable features..." maxlength="500"></textarea>
                    <div class="char-counter"><span id="scoutNotesCount">0</span>/500</div>
                </div>
                <div class="consent-section">
                    <div class="consent-title">üì¢ Sharing Preferences</div>
                    <div class="consent-question">
                        <label class="consent-label">Include in public Activity Feed?</label>
                        <div class="consent-options">
                            <div class="radio-option"><input type="radio" id="scoutFeedYes" name="scoutFeed" value="yes"><label for="scoutFeedYes">Yes</label></div>
                            <div class="radio-option"><input type="radio" id="scoutFeedNo" name="scoutFeed" value="no"><label for="scoutFeedNo">No</label></div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" id="submitScoutBtn" disabled>Submit Scout Report</button>
                <button class="btn btn-secondary" id="cancelScoutBtn">Cancel</button>
            </div>

            <!-- ==================== ACTIVE TRACKING ==================== -->
            <div id="activeTrackingScreen" class="hidden">
                <div class="status-box">
                    <div class="status-row"><span class="status-label">üìç Tracking</span><span class="status-value tracking">Active</span></div>
                    <div class="status-row"><span class="status-label">‚è±Ô∏è Duration</span><span class="status-value" id="trackingDuration">00:00</span></div>
                    <div class="status-row"><span class="status-label">üìè Distance</span><span class="status-value" id="trackingDistance">0.00 mi</span></div>
                </div>
                <div class="photo-section">
                    <label for="trackingPhotoInput" class="photo-btn">üì∏ Take Photo</label>
                    <input type="file" id="trackingPhotoInput" accept="image/*" capture="environment" style="display: none;">
                    <div class="photo-count" id="trackingPhotoCount">0 photos captured</div>
                </div>
                <button class="btn btn-danger" id="stopTrackingBtn">‚èπÔ∏è Stop Tracking</button>
            </div>

            <!-- ==================== POST-TRACKING ==================== -->
            <div id="postTrackingScreen" class="hidden">
                <div class="status-box">
                    <div class="status-row"><span class="status-label">Session Complete</span><span class="status-value">‚úì</span></div>
                    <div class="status-row"><span class="status-label">Duration</span><span class="status-value" id="finalDuration">00:00</span></div>
                    <div class="status-row"><span class="status-label">Distance</span><span class="status-value" id="finalDistance">0.00 mi</span></div>
                </div>
                <h3 style="font-size: 15px; color: #1f2937; margin: 16px 0 12px;">üìä Litter Rating (Optional)</h3>
                <div class="rating-value untouched" id="postRatingValue">‚Äî</div>
                <div class="rating-description" id="postRatingDesc">Tap the slider to rate</div>
                <div class="rating-scale"><span>0 - Clean</span><span>5 - Moderate</span><span>10 - Severe</span></div>
                <input type="range" class="slider untouched" id="postRatingSlider" min="0" max="10" value="5" step="1">
                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea class="notes-textarea" id="postNotes" placeholder="Describe this location..." maxlength="500"></textarea>
                    <div class="char-counter"><span id="postNotesCount">0</span>/500</div>
                </div>
                <h3 style="font-size: 15px; color: #1f2937; margin: 20px 0 12px;">üóëÔ∏è Collection Data</h3>
                <div id="bagsContainer"></div>
                <button class="add-bag-btn" id="addBagBtn">+ Add Bag</button>
                <div class="consent-section" style="margin-top: 20px;">
                    <div class="consent-title">üì¢ Sharing Preferences</div>
                    <div class="consent-question">
                        <label class="consent-label">Include in public Activity Feed?</label>
                        <div class="consent-options">
                            <div class="radio-option"><input type="radio" id="postFeedYes" name="postFeed" value="yes"><label for="postFeedYes">Yes</label></div>
                            <div class="radio-option"><input type="radio" id="postFeedNo" name="postFeed" value="no"><label for="postFeedNo">No</label></div>
                        </div>
                    </div>
                    <div class="consent-question hidden" id="photoConsentQuestion">
                        <label class="consent-label">Allow photos for promotional use?</label>
                        <div class="consent-options">
                            <div class="radio-option"><input type="radio" id="photoConsentYes" name="photoConsent" value="yes"><label for="photoConsentYes">Yes</label></div>
                            <div class="radio-option"><input type="radio" id="photoConsentNo" name="photoConsent" value="no"><label for="photoConsentNo">No</label></div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" id="submitCollectionBtn" disabled>Submit Report</button>
                <button class="btn btn-secondary" id="cancelCollectionBtn">Cancel</button>
            </div>

            <!-- ==================== EDIT PROFILE ==================== -->
            <div id="editProfileScreen" class="hidden">
                <div class="instructions"><strong>‚úèÔ∏è Edit Profile</strong><br>Update your information.</div>
                <div class="form-group">
                    <label class="form-label">Handle</label>
                    <input type="text" class="form-input" id="editHandle" disabled style="background: #f3f4f6; color: #6b7280;">
                    <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">Handle cannot be changed</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Organization</label>
                    <select class="form-select" id="editOrgSelect">
                        <option value="Baled It!">Baled It!</option>
                        <option value="Help A Brother Out Foundation">Help A Brother Out Foundation</option>
                        <option value="West Montgomery Action Committee">West Montgomery Action Committee</option>
                        <option value="other">Other...</option>
                    </select>
                    <div class="custom-org-input" id="editCustomOrg">
                        <input type="text" class="form-input" id="editCustomOrgText" placeholder="Enter organization name">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email (Optional)</label>
                    <input type="email" class="form-input" id="editEmail" placeholder="For event notifications only">
                    <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">üîí Never shared publicly. Used only for event notifications if you opt in.</div>
                </div>
                <h3 style="font-size: 15px; color: #1f2937; margin: 20px 0 12px;">üìç Addresses</h3>
                <div id="addressesContainer"></div>
                <button class="add-bag-btn" id="addAddressBtn">+ Add Address</button>
                <button class="btn btn-primary" id="saveProfileBtn" style="margin-top: 20px;">Save Changes</button>
                <button class="btn btn-secondary" id="cancelEditBtn">Cancel</button>
            </div>

            <!-- ==================== HOUSEHOLD RECYCLING ==================== -->
            <div id="recycleScreen" class="hidden">
                <h2 style="font-size: 18px; margin-bottom: 16px; color: #1f2937;">‚ôªÔ∏è Log Recycling</h2>
                <div class="info-dropdown-toggle" id="hrInfoToggle">‚ÑπÔ∏è For more information on recycling locally...</div>
                <div class="info-dropdown-pane" id="hrInfoPane">
                    <h4>COMING SOON</h4>
                    <p>Recycling in Montgomery is challenging. We're working to identify accessible alternatives for residents.</p>
                </div>
                <div class="info-dropdown-toggle" id="dropoffToggle">üìç View validated dropoff locations...</div>
                <div class="info-dropdown-pane" id="dropoffPane">
                    <h4>COMING SOON</h4>
                    <p>We're building a directory of verified recycling dropoff points in Montgomery.</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Material Type</label>
                    <select class="form-select" id="hrMaterialType">
                        <option value="">Select material...</option>
                        <option value="Aluminum">Aluminum (cans, foil)</option>
                        <option value="Cardboard">Cardboard</option>
                        <option value="Glass">Glass</option>
                        <option value="Paper">Paper (office, newspaper)</option>
                        <option value="Plastic #1 PET">Plastic #1 (PET - bottles)</option>
                        <option value="Plastic #2 HDPE">Plastic #2 (HDPE - jugs)</option>
                        <option value="Plastic #5 PP">Plastic #5 (PP - containers)</option>
                        <option value="Steel/Tin">Steel / Tin cans</option>
                        <option value="Mixed">Mixed recyclables</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group hidden" id="hrDescriptionWrap">
                    <label class="form-label">Description (required for Mixed/Other)</label>
                    <input type="text" class="form-input" id="hrDescription" placeholder="Describe the materials">
                </div>
                <div class="form-group">
                    <label class="form-label">Estimated Weight (lbs)</label>
                    <input type="number" class="form-input" id="hrWeight" placeholder="0.0" step="0.1" min="0">
                    <div class="scale-tip">üí° <strong>No scale?</strong> Weigh yourself holding the bag, then without. Subtract.</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Date Bagged/Sealed</label>
                    <input type="date" class="form-input" id="hrDateBagged">
                </div>
                <div class="form-group">
                    <label class="form-label">Where is this going?</label>
                    <select class="form-select" id="hrDestination">
                        <option value="">Select destination...</option>
                        <option value="Municipal">Municipal</option>
                        <option value="Other">Other</option>
                    </select>
                    <div class="custom-org-input" id="hrDestOtherWrap">
                        <input type="text" class="form-input" id="hrDestOther" placeholder="Describe destination">
                    </div>
                </div>
                <button class="btn btn-primary" id="submitHRBtn" disabled>Submit Recycling Log</button>
                <button class="btn btn-secondary" id="cancelHRBtn">Cancel</button>
            </div>

            <!-- ==================== EVENT MANAGER (Coordinator Only) ==================== -->
            <div id="eventManagerScreen" class="hidden">
                <div class="instructions"><strong>üìÖ Event Manager</strong><br>Propose and manage cleanup events. Approved events appear publicly.</div>
                <button class="btn btn-primary" id="proposeEventBtn" style="width: 100%; margin-bottom: 16px;">+ Propose New Event</button>
                <div class="form-group">
                    <label class="form-label">My Events</label>
                    <div id="myEventsList" style="background: #f9fafb; border-radius: 12px; min-height: 100px;">
                        <div style="text-align: center; color: #6b7280; padding: 30px;">Loading...</div>
                    </div>
                </div>
                <div class="btn-group"><button class="btn btn-secondary" id="backFromEventManagerBtn">‚Üê Back</button></div>
            </div>

            <!-- ==================== PROPOSE EVENT ==================== -->
            <div id="proposeEventScreen" class="hidden">
                <div class="instructions"><strong>üìù Propose Event</strong><br>Fill in event details. Admin approval required before it goes live.</div>
                <div class="form-group">
                    <label class="form-label">Event Title *</label>
                    <input type="text" class="form-input" id="eventTitleInput" placeholder="e.g., Spring Cleanup at Oak Park">
                </div>
                <div class="form-group">
                    <label class="form-label">Organizing Group *</label>
                    <select class="form-select" id="eventOrgSelect">
                        <option value="">Select organization...</option>
                        <option value="Baled It!">Baled It!</option>
                        <option value="Help A Brother Out Foundation">Help A Brother Out Foundation</option>
                        <option value="West Montgomery Action Committee">West Montgomery Action Committee</option>
                        <option value="other">Other...</option>
                    </select>
                    <div class="custom-org-input hidden" id="eventCustomOrg">
                        <input type="text" class="form-input" id="eventCustomOrgText" placeholder="Enter organization name">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Event Date *</label>
                    <input type="date" class="form-input" id="eventDateInput">
                </div>
                <div style="display: flex; gap: 12px;">
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">Start Time</label>
                        <input type="time" class="form-input" id="eventStartTimeInput">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">End Time</label>
                        <input type="time" class="form-input" id="eventEndTimeInput">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Timezone</label>
                    <select class="form-select" id="eventTimezoneInput">
                        <option value="America/New_York">Eastern (ET)</option>
                        <option value="America/Chicago" selected>Central (CT)</option>
                        <option value="America/Denver">Mountain (MT)</option>
                        <option value="America/Los_Angeles">Pacific (PT)</option>
                        <option value="America/Anchorage">Alaska (AKT)</option>
                        <option value="Pacific/Honolulu">Hawaii (HT)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Location Name *</label>
                    <input type="text" class="form-input" id="eventLocationInput" placeholder="e.g., Oak Park Pavilion">
                </div>
                <div class="form-group">
                    <label class="form-label">Location Address or Coordinates</label>
                    <input type="text" class="form-input" id="eventAddressInput" placeholder="123 Main St or 32.3792, -86.3077">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="notes-textarea" id="eventDescriptionInput" rows="3" placeholder="What should participants know? Parking info, what to bring, etc."></textarea>
                </div>
                <div class="consent-section" style="margin-top: 16px;">
                    <div class="consent-title">üìû Event Contact (Optional)</div>
                    <div class="form-group" style="margin-top: 8px;">
                        <input type="text" class="form-input" id="eventContactName" placeholder="Contact Name">
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <div class="form-group" style="flex: 1;"><input type="tel" class="form-input" id="eventContactPhone" placeholder="Phone"></div>
                        <div class="form-group" style="flex: 1;"><input type="email" class="form-input" id="eventContactEmail" placeholder="Email"></div>
                    </div>
                </div>
                <div class="consent-section" style="margin-top: 16px;">
                    <div class="consent-title">üåê Public Visibility</div>
                    <div class="consent-question">
                        <label class="consent-label">Show this event to visitors before they log in?</label>
                        <div style="font-size: 11px; color: #6b7280; margin-bottom: 8px;">If approved, this event will appear on the public-facing events list. Admin confirmation required.</div>
                        <div class="consent-options">
                            <div class="radio-option"><input type="radio" id="eventPublicYes" name="eventPublic" value="yes"><label for="eventPublicYes">Yes, request public</label></div>
                            <div class="radio-option"><input type="radio" id="eventPublicNo" name="eventPublic" value="no" checked><label for="eventPublicNo">No</label></div>
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="submitEventProposalBtn">Submit for Approval</button>
                    <button class="btn btn-secondary" id="cancelEventProposalBtn">Cancel</button>
                </div>
            </div>

            <!-- ==================== EVENT DETAIL (Coordinator) ==================== -->
            <div id="eventDetailScreen" class="hidden">
                <div class="instructions">
                    <strong>üìÖ <span id="eventDetailTitle">Event Details</span></strong><br>
                    <span id="eventDetailStatus" style="font-size: 12px;"></span>
                </div>
                <div class="status-box" id="eventDetailInfo">
                    <div class="status-row"><span class="status-label">üìÖ Date</span><span class="status-value" id="eventDetailDate">-</span></div>
                    <div class="status-row"><span class="status-label">üïê Time</span><span class="status-value" id="eventDetailTime">-</span></div>
                    <div class="status-row"><span class="status-label">üìç Location</span><span class="status-value" id="eventDetailLocation">-</span></div>
                </div>
                <div id="eventDetailDescription" style="background: #f0fdf4; border-radius: 12px; padding: 14px; margin-bottom: 16px; display: none;">
                    <div style="font-size: 12px; color: #166534; font-weight: 600; margin-bottom: 6px;">Description</div>
                    <div id="eventDetailDescText" style="color: #15803d; font-size: 14px;"></div>
                </div>
                <div id="suppliesSection" style="display: none;">
                    <div class="consent-section">
                        <div class="consent-title">üì¶ Supplies</div>
                        <div id="suppliesList" style="margin-top: 8px;"></div>
                        <button class="btn btn-secondary" id="addSupplyBtn" style="margin-top: 8px; font-size: 13px; padding: 8px 12px;">+ Add Supply</button>
                    </div>
                </div>
                <div id="postUpdateSection" style="display: none; margin-top: 16px;">
                    <div class="form-group">
                        <label class="form-label">Post Update to Activity Feed</label>
                        <textarea class="notes-textarea" id="eventUpdateText" rows="2" placeholder="Share news about this event..."></textarea>
                    </div>
                    <button class="btn btn-primary" id="postEventUpdateBtn" style="width: 100%;">Post Update</button>
                </div>
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-secondary" id="backFromEventDetailBtn">‚Üê Back</button>
                    <button class="btn btn-danger" id="cancelEventBtn" style="display: none;">Cancel Event</button>
                </div>
            </div>

            <!-- ==================== UPCOMING EVENTS ==================== -->
            <div id="upcomingEventsScreen" class="hidden">
                <div class="instructions"><strong>üìÜ Upcoming Events</strong><br>Community cleanup events organized by volunteer coordinators.</div>
                <div id="upcomingEventsList" style="min-height: 100px;">
                    <div style="text-align: center; color: #6b7280; padding: 30px;">Loading...</div>
                </div>
                <div class="btn-group"><button class="btn btn-secondary" id="backFromUpcomingBtn">‚Üê Back</button></div>
            </div>

            <!-- ==================== ADMIN DASHBOARD ==================== -->
            <div id="adminScreen" class="hidden">
                <div style="padding: 4px 0 12px;">
                    <div style="font-size: 18px; font-weight: 700; color: #1f2937;">Admin Dashboard</div>
                    <div style="font-size: 12px; color: #6b7280;">CHIMERA system management</div>
                </div>

                <!-- Quick Stats -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection(this)">
                        <h4>üìä Quick Stats</h4>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="admin-section-body" id="adminStatsBody">
                        <div class="admin-stats-grid" id="adminStatsGrid">
                            <div class="admin-stat-card">
                                <div class="admin-stat-value" id="adminStatUsers">-</div>
                                <div class="admin-stat-label">Users</div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-value" id="adminStatSessions">-</div>
                                <div class="admin-stat-label">Sessions</div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-value" id="adminStatValidations">-</div>
                                <div class="admin-stat-label">Validations</div>
                            </div>
                        </div>
                        <button class="admin-action-btn secondary" onclick="loadAdminStats()" style="width:100%;">Refresh Stats</button>
                    </div>
                </div>

                <!-- Feedback Inbox -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection(this)">
                        <h4>üí¨ Feedback Inbox <span class="menu-badge" id="feedbackInboxBadge" style="display:none;">0</span></h4>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="admin-section-body" id="adminFeedbackBody">
                        <div style="display: flex; gap: 6px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button class="admin-action-btn secondary" style="font-size:11px;" onclick="loadAdminFeedback('all')" id="fbFilterAll">All</button>
                            <button class="admin-action-btn secondary" style="font-size:11px;" onclick="loadAdminFeedback('new')" id="fbFilterNew">New</button>
                            <button class="admin-action-btn secondary" style="font-size:11px;" onclick="loadAdminFeedback('in_progress')" id="fbFilterProgress">In Progress</button>
                            <button class="admin-action-btn secondary" style="font-size:11px;" onclick="loadAdminFeedback('resolved')" id="fbFilterResolved">Resolved</button>
                        </div>
                        <div id="adminFeedbackList">
                            <div style="text-align:center; color:#9ca3af; font-size:13px; padding:20px;">Loading...</div>
                        </div>
                        <div id="adminFeedbackDetail" style="display:none;">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                                <strong style="font-size:14px; color:#1f2937;" id="fbDetailType">Bug Report</strong>
                                <button class="admin-action-btn secondary" onclick="closeFeedbackDetail()" style="font-size:11px;">‚Üê Back</button>
                            </div>
                            <div style="font-size:13px; color:#374151; margin-bottom:8px;" id="fbDetailMessage"></div>
                            <div style="font-size:11px; color:#6b7280; margin-bottom:8px;">
                                From: <strong id="fbDetailUser"></strong> ¬∑ <span id="fbDetailTime"></span>
                            </div>
                            <div class="feedback-detail-context" id="fbDetailContext"></div>
                            <div style="margin-top:12px;">
                                <label style="font-size:12px; font-weight:600; color:#374151;">Admin Notes</label>
                                <textarea class="admin-pause-textarea" id="fbDetailNotes" placeholder="Add notes..." style="min-height:50px;"></textarea>
                            </div>
                            <div style="display:flex; gap:6px; margin-top:10px; flex-wrap:wrap;">
                                <button class="admin-action-btn secondary" onclick="updateFeedbackStatus('read')">Mark Read</button>
                                <button class="admin-action-btn primary" onclick="updateFeedbackStatus('in_progress')">In Progress</button>
                                <button class="admin-action-btn primary" onclick="updateFeedbackStatus('resolved')">Resolved</button>
                                <button class="admin-action-btn danger" onclick="updateFeedbackStatus('wont_fix')">Won't Fix</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Site Pause -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection(this)">
                        <h4>‚öôÔ∏è Site Pause</h4>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="admin-section-body">
                        <div class="admin-control-row">
                            <div>
                                <div class="control-label">Site Status</div>
                                <div class="control-desc" id="adminSiteStatusDesc">Checking...</div>
                            </div>
                            <label class="admin-toggle danger">
                                <input type="checkbox" id="adminSitePauseToggle" onchange="toggleAdminSitePause()">
                                <span class="admin-toggle-slider"></span>
                            </label>
                        </div>
                        <textarea class="admin-pause-textarea" id="adminPauseMessage" placeholder="Pause message shown to users..."></textarea>
                        <button class="admin-action-btn secondary" onclick="saveAdminPauseMessage()" style="margin-top:8px;">Save Message</button>
                    </div>
                </div>

                <!-- Banners -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection(this)">
                        <h4>üì¢ Banners</h4>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="admin-section-body" id="adminBannersBody">
                        <div id="adminBannersList">
                            <div style="text-align:center; color:#9ca3af; font-size:13px; padding:20px;">Loading...</div>
                        </div>
                        <div style="margin-top:10px; padding-top:10px; border-top:1px solid #e5e7eb;">
                            <div style="font-size:12px; font-weight:600; color:#374151; margin-bottom:6px;">Quick Banner</div>
                            <textarea class="admin-pause-textarea" id="adminNewBannerMessage" placeholder="Type a new banner message..." style="min-height:50px;"></textarea>
                            <div style="display:flex; gap:6px; margin-top:8px; flex-wrap:wrap;">
                                <select id="adminNewBannerType" style="padding:6px 10px; border:1px solid #d1d5db; border-radius:6px; font-size:12px; color:#374151;">
                                    <option value="info">Info</option>
                                    <option value="success">Success</option>
                                    <option value="warning">Warning</option>
                                    <option value="event">Event</option>
                                </select>
                                <button class="admin-action-btn primary" onclick="createQuickBanner()">Post Banner</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Events -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection(this)">
                        <h4>üìÖ Pending Events <span class="menu-badge" id="pendingEventsBadge" style="display:none;">0</span></h4>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="admin-section-body" id="adminEventsBody">
                        <div id="adminPendingEventsList">
                            <div style="text-align:center; color:#9ca3af; font-size:13px; padding:20px;">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Manual Operations -->
                <div class="admin-section">
                    <div class="admin-section-header collapsed" onclick="toggleAdminSection(this)">
                        <h4>üõ†Ô∏è Operations</h4>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="admin-section-body collapsed">
                        <div class="admin-control-row">
                            <div>
                                <div class="control-label">Run Validation</div>
                                <div class="control-desc">Process pending scout validations</div>
                            </div>
                            <button class="admin-action-btn primary" id="adminRunValidationBtn" onclick="runAdminValidation()">Run</button>
                        </div>
                        <div class="admin-control-row">
                            <div>
                                <div class="control-label">Evaluate Rules</div>
                                <div class="control-desc">Run event detection rules</div>
                            </div>
                            <button class="admin-action-btn primary" onclick="runAdminEvaluateRules()">Run</button>
                        </div>
                        <div class="admin-control-row">
                            <div>
                                <div class="control-label">Full AdminPortal</div>
                                <div class="control-desc">Open desktop admin interface</div>
                            </div>
                            <button class="admin-action-btn secondary" onclick="window.open('chimera_admin_v4_hunt.html','_blank')">Open</button>
                        </div>
                    </div>
                </div>
                <!-- User Overrides Section -->
<div class="admin-section">
    <div class="admin-section-header" onclick="toggleAdminSection(this)">
        <span>User Overrides</span>
        <span class="admin-section-toggle">‚ñº</span>
    </div>
    <div class="admin-section-body">
        <div id="adminOverridesList"></div>
    </div>
</div>
                <!-- Content Editors -->
<div class="admin-section">
    <div class="admin-section-header" onclick="toggleAdminSection(this)">
        <span>Content Editors</span>
        <span class="admin-section-toggle">‚ñº</span>
    </div>
    <div class="admin-section-body collapsed">
        <!-- Getting Started -->
        <div style="margin-bottom:16px;">
            <div style="font-weight:600; font-size:13px; color:#374151; margin-bottom:4px;">üí° Getting Started</div>
            <textarea id="adminContentGettingStarted" rows="8" style="width:100%; border:1px solid #d1d5db; border-radius:6px; padding:8px; font-size:12px; font-family:monospace; resize:vertical;"></textarea>
            <button onclick="saveAdminContent('getting_started', 'adminContentGettingStarted')" style="margin-top:4px; padding:4px 12px; background:#2D5F3F; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Save</button>
        </div>

        <!-- Safety/Legal -->
        <div style="margin-bottom:16px;">
            <div style="font-weight:600; font-size:13px; color:#374151; margin-bottom:4px;">‚ö†Ô∏è Safety & Legal</div>
            <textarea id="adminContentSafetyLegal" rows="8" style="width:100%; border:1px solid #d1d5db; border-radius:6px; padding:8px; font-size:12px; font-family:monospace; resize:vertical;"></textarea>
            <button onclick="saveAdminContent('safety_legal', 'adminContentSafetyLegal')" style="margin-top:4px; padding:4px 12px; background:#2D5F3F; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Save</button>
        </div>

        <!-- Wiki Topics -->
        <div style="font-weight:700; font-size:13px; color:#1f2937; margin:12px 0 8px; border-top:1px solid #e5e7eb; padding-top:12px;">üìö Wiki Topics</div>

        <div style="margin-bottom:12px; padding:10px; background:#f9fafb; border-radius:8px;">
            <input id="adminTitleWikiCpue" placeholder="Title (e.g. üìä What is ‚àöCPUE?)" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <input id="adminSubtitleWikiCpue" placeholder="Subtitle" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <textarea id="adminContentWikiCpue" rows="5" style="width:100%; border:1px solid #d1d5db; border-radius:6px; padding:8px; font-size:12px; font-family:monospace; resize:vertical;" placeholder="Topic content (HTML)"></textarea>
            <button onclick="saveWikiContent('wiki_cpue')" style="margin-top:4px; padding:4px 12px; background:#2D5F3F; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Save</button>
        </div>

        <div style="margin-bottom:12px; padding:10px; background:#f9fafb; border-radius:8px;">
            <input id="adminTitleWikiZones" placeholder="Title (e.g. üó∫Ô∏è Montgomery Zones)" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <input id="adminSubtitleWikiZones" placeholder="Subtitle" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <textarea id="adminContentWikiZones" rows="5" style="width:100%; border:1px solid #d1d5db; border-radius:6px; padding:8px; font-size:12px; font-family:monospace; resize:vertical;" placeholder="Topic content (HTML)"></textarea>
            <button onclick="saveWikiContent('wiki_zones')" style="margin-top:4px; padding:4px 12px; background:#2D5F3F; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Save</button>
        </div>

        <div style="margin-bottom:12px; padding:10px; background:#f9fafb; border-radius:8px;">
            <input id="adminTitleWikiValidation" placeholder="Title (e.g. ‚úì Scout Validation)" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <input id="adminSubtitleWikiValidation" placeholder="Subtitle" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <textarea id="adminContentWikiValidation" rows="5" style="width:100%; border:1px solid #d1d5db; border-radius:6px; padding:8px; font-size:12px; font-family:monospace; resize:vertical;" placeholder="Topic content (HTML)"></textarea>
            <button onclick="saveWikiContent('wiki_validation')" style="margin-top:4px; padding:4px 12px; background:#2D5F3F; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Save</button>
        </div>

        <div style="margin-bottom:12px; padding:10px; background:#f9fafb; border-radius:8px;">
            <input id="adminTitleWikiSafety" placeholder="Title (e.g. ‚ö†Ô∏è Safety Guidelines)" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <input id="adminSubtitleWikiSafety" placeholder="Subtitle" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <textarea id="adminContentWikiSafety" rows="5" style="width:100%; border:1px solid #d1d5db; border-radius:6px; padding:8px; font-size:12px; font-family:monospace; resize:vertical;" placeholder="Topic content (HTML)"></textarea>
            <button onclick="saveWikiContent('wiki_safety')" style="margin-top:4px; padding:4px 12px; background:#2D5F3F; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Save</button>
        </div>

        <div style="margin-bottom:12px; padding:10px; background:#f9fafb; border-radius:8px;">
            <input id="adminTitleWikiPrivacy" placeholder="Title (e.g. üîí Privacy & Data)" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <input id="adminSubtitleWikiPrivacy" placeholder="Subtitle" style="width:100%; padding:4px 8px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; margin-bottom:4px;">
            <textarea id="adminContentWikiPrivacy" rows="5" style="width:100%; border:1px solid #d1d5db; border-radius:6px; padding:8px; font-size:12px; font-family:monospace; resize:vertical;" placeholder="Topic content (HTML)"></textarea>
            <button onclick="saveWikiContent('wiki_privacy')" style="margin-top:4px; padding:4px 12px; background:#2D5F3F; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Save</button>
        </div>

        <div style="font-size:11px; color:#9ca3af; font-style:italic; margin-top:8px;">Content supports HTML. Changes appear for all users on next page load.</div>
    </div>
</div>
                <!-- Zone Manager -->
<div class="admin-section" id="zoneManagerSection">
    <div class="admin-section-header" onclick="toggleAdminSection(this)">
        <span>üó∫Ô∏è Zone Manager</span>
        <span class="admin-section-toggle">‚ñº</span>
    </div>
    <div class="admin-section-body collapsed">
        <div style="font-size:12px; color:#6b7280; margin-bottom:8px;">Draw polygons on the map to create zones. Click existing zones to edit.</div>
        <div id="zoneMapContainer" style="width:100%; height:350px; border-radius:8px; border:1px solid #d1d5db; margin-bottom:10px; background:#eee;"></div>

        <!-- Zone List -->
        <div style="margin-bottom:10px;">
            <div style="font-weight:600; font-size:12px; color:#374151; margin-bottom:6px;">Existing Zones</div>
            <div id="zoneListItems"><div style="color:#9ca3af; text-align:center; font-size:13px; padding:10px;">Loading...</div></div>
        </div>

        <!-- Zone Editor Panel (hidden until drawing/editing) -->
        <div id="zoneEditorPanel" style="display:none; padding:12px; background:#f9fafb; border-radius:8px; margin-bottom:10px;">
            <div style="font-weight:600; font-size:13px; color:#374151; margin-bottom:8px;" id="zoneEditorTitle">New Zone</div>
            <div style="margin-bottom:8px;">
                <label style="font-size:12px; color:#6b7280;">Name</label>
                <input type="text" id="zoneNameInput" placeholder="e.g. Garden District" style="width:100%; padding:6px 8px; border:1px solid #d1d5db; border-radius:6px; font-size:13px;">
            </div>
            <div style="margin-bottom:8px;">
                <label style="display:flex; align-items:center; gap:6px; font-size:12px; color:#6b7280; cursor:pointer;">
                    <input type="checkbox" id="zoneActiveToggle" checked> Active
                </label>
            </div>
            <input type="hidden" id="zonePolygonData">
            <div style="display:flex; gap:6px;">
                <button onclick="saveZone()" style="padding:6px 14px; background:#2D5F3F; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Save Zone</button>
                <button onclick="cancelZoneEdit()" style="padding:6px 14px; background:#6b7280; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Cancel</button>
                <button onclick="deleteZone()" id="deleteZoneBtn" style="display:none; padding:6px 14px; background:#dc2626; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Delete</button>
            </div>
        </div>

        <!-- Batch Operations -->
        <div style="border-top:1px solid #e5e7eb; padding-top:10px; margin-top:10px;">
            <button onclick="recalculateAllZones()" id="recalcZonesBtn" style="padding:6px 14px; background:#6b7280; color:white; border:none; border-radius:6px; font-size:12px; cursor:pointer;">Recalculate All Session Zones</button>
            <div style="font-size:11px; color:#9ca3af; margin-top:4px;">Run after editing zones to update existing session zone assignments.</div>
        </div>
    </div>
</div>
            </div>

        </div><!-- end .content -->
    </div><!-- end .container -->

    <!-- ==================== MODALS ==================== -->

    <!-- Getting Started -->
    <div class="modal-overlay" id="gettingStartedModal">
        <div class="modal">
            <div class="modal-header"><div class="modal-title">üí° Getting Started</div></div>
            <div class="modal-content">
                <p><strong>Welcome to CHIMERA!</strong></p>
                <p>Choose a mode from the menu:</p>
                <h4>üîç Rate Location</h4>
                <p>Scout a location and rate litter density (0-10). Your ratings get validated when collectors clean nearby.</p>
                <h4>üóëÔ∏è Live Track: ‚àöCPUE</h4>
                <p>Track your cleanup with GPS. Record bags collected to calculate your efficiency score.</p>
                <h4>‚ôªÔ∏è Recycle</h4>
                <p>Log household recycling to support the case for expanded infrastructure.</p>
            </div>
            <div class="modal-footer"><button class="btn btn-primary" id="closeGettingStarted">Got It</button></div>
        </div>
    </div>

    <!-- CHIMERAwiki -->
    <div class="modal-overlay" id="wikiModal">
        <div class="modal" style="max-height: 85vh; overflow-y: auto;">
            <div class="modal-header"><div class="modal-title">üìö CHIMERAwiki</div></div>
            <div class="modal-content">
                <p style="color: #6b7280; font-style: italic;">A growing knowledge base for CHIMERA volunteers.</p>
                <div style="margin: 16px 0; padding: 12px; background: #f9fafb; border-radius: 8px; cursor: pointer;" onclick="showWikiTopic('cpue')">
                    <strong>üìä What is ‚àöCPUE?</strong>
                    <div style="font-size: 12px; color: #6b7280;">Understanding the efficiency metric</div>
                </div>
                <div style="margin: 16px 0; padding: 12px; background: #f9fafb; border-radius: 8px; cursor: pointer;" onclick="showWikiTopic('zones')">
                    <strong>üó∫Ô∏è Montgomery Zones</strong>
                    <div style="font-size: 12px; color: #6b7280;">How collection zones work</div>
                </div>
                <div style="margin: 16px 0; padding: 12px; background: #f9fafb; border-radius: 8px; cursor: pointer;" onclick="showWikiTopic('validation')">
                    <strong>‚úì Scout Validation</strong>
                    <div style="font-size: 12px; color: #6b7280;">How ratings get verified</div>
                </div>
                <div style="margin: 16px 0; padding: 12px; background: #f9fafb; border-radius: 8px; cursor: pointer;" onclick="showWikiTopic('safety')">
                    <strong>‚ö†Ô∏è Safety Guidelines</strong>
                    <div style="font-size: 12px; color: #6b7280;">Stay safe while collecting</div>
                </div>
                <div style="margin: 16px 0; padding: 12px; background: #f9fafb; border-radius: 8px; cursor: pointer;" onclick="showWikiTopic('privacy')">
                    <strong>üîí Privacy & Data</strong>
                    <div style="font-size: 12px; color: #6b7280;">What we collect and why</div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" id="closeWiki">Close</button></div>
        </div>
    </div>

    <!-- Wiki Topic -->
    <div class="modal-overlay" id="wikiTopicModal">
        <div class="modal">
            <div class="modal-header"><div class="modal-title" id="wikiTopicTitle">Topic</div></div>
            <div class="modal-content" id="wikiTopicContent"></div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="document.getElementById('wikiTopicModal').classList.remove('show');">Back to Wiki</button></div>
        </div>
    </div>

    <!-- Safety/Legal -->
    <div class="modal-overlay" id="safetyLegalModal">
        <div class="modal">
            <div class="modal-header"><div class="modal-title">‚ö†Ô∏è Safety & Legal</div></div>
            <div class="modal-content">
                <h4>Safety Guidelines</h4>
                <ul>
                    <li>Watch for traffic when crossing streets</li>
                    <li>Wear gloves when handling litter</li>
                    <li>Stay hydrated and take breaks</li>
                    <li>Work in pairs when possible</li>
                    <li><strong>Do NOT operate a vehicle while tracking</strong></li>
                    <li>Stay aware of your surroundings</li>
                    <li>Watch for hazards (glass, sharp objects, wildlife)</li>
                </ul>
                <h4>Data Collection</h4>
                <p>CHIMERA collects GPS location, litter ratings, collection weights, and photos during sessions.</p>
                <h4>Data Retention</h4>
                <p>GPS coordinates archived after validation, deleted after 30 days. Photos retained unless you request deletion.</p>
                <h4>Liability</h4>
                <p>You participate at your own risk. Always prioritize safety.</p>
                <div class="safety-checkbox">
                    <input type="checkbox" id="safetyLegalAck">
                    <label for="safetyLegalAck">I understand and agree</label>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-primary" id="acceptSafetyLegal" disabled>Accept & Continue</button></div>
        </div>
    </div>

    <!-- Add Address -->
    <div class="modal-overlay" id="addAddressModal">
        <div class="modal">
            <div class="modal-header"><div class="modal-title">üìç Add Address</div></div>
            <div class="modal-content">
                <div class="form-group">
                    <label class="form-label">Address Type</label>
                    <select class="form-select" id="newAddressType"><option value="Home">Home</option><option value="Work">Work</option><option value="Other">Other</option></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Street Address</label>
                    <input type="text" class="form-input" id="newAddressStreet" placeholder="123 Main St">
                </div>
                <div class="form-group">
                    <label class="form-label">Neighborhood</label>
                    <input type="text" class="form-input" id="newAddressNeighborhood" placeholder="e.g. Cloverdale">
                </div>
                <div class="form-group">
                    <label class="form-label">Zip Code</label>
                    <input type="text" class="form-input" id="newAddressZip" placeholder="36104" maxlength="5">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveNewAddress">Save Address</button>
                <button class="btn btn-secondary" id="cancelNewAddress">Cancel</button>
            </div>
        </div>
    </div>

    <!-- ==================== PASSWORD UPGRADE MODAL ==================== -->
    <div class="feedback-overlay" id="passwordUpgradeOverlay">
        <div class="feedback-modal">
            <div class="feedback-modal-header">
                <h3>üîí Security Upgrade</h3>
            </div>
            <div class="feedback-modal-body">
                <div style="font-size: 13px; color: #6b7280; margin-bottom: 16px;">
                    We've upgraded our security. Please set a new password (minimum 8 characters) to replace your old PIN.
                </div>
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <div class="pin-input-wrapper">
                        <input type="password" class="form-input" id="upgradeNewPassword" placeholder="8+ characters" autocomplete="off">
                        <span class="pin-toggle" onclick="togglePIN('upgradeNewPassword', this)">üëÅÔ∏è</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <div class="pin-input-wrapper">
                        <input type="password" class="form-input" id="upgradeConfirmPassword" placeholder="Re-enter password" autocomplete="off">
                        <span class="pin-toggle" onclick="togglePIN('upgradeConfirmPassword', this)">üëÅÔ∏è</span>
                    </div>
                </div>
                <div id="upgradePasswordError" style="font-size: 12px; color: #dc2626; min-height: 18px; margin-bottom: 8px;"></div>
                <button class="feedback-submit-btn" id="upgradePasswordBtn" disabled>Set New Password</button>
                <button class="btn btn-secondary" id="upgradeSkipBtn" style="width: 100%; margin-top: 8px;">Remind Me Later</button>
            </div>
        </div>
    </div>

    <!-- ==================== FEEDBACK MODAL ==================== -->
    <div class="feedback-overlay" id="feedbackOverlay">
        <div class="feedback-modal">
            <div class="feedback-modal-header">
                <h3>Send Feedback</h3>
                <button class="feedback-close-btn" id="feedbackCloseBtn">&times;</button>
            </div>
            <div class="feedback-modal-body">
                <div style="font-size: 13px; color: #6b7280; margin-bottom: 12px;">What kind of feedback?</div>
                <div class="feedback-type-grid">
                    <button class="feedback-type-btn selected" data-type="bug">
                        <span class="fb-icon">üêõ</span>Bug Report
                    </button>
                    <button class="feedback-type-btn" data-type="suggestion">
                        <span class="fb-icon">üí°</span>Suggestion
                    </button>
                    <button class="feedback-type-btn" data-type="question">
                        <span class="fb-icon">‚ùì</span>Question
                    </button>
                    <button class="feedback-type-btn" data-type="general">
                        <span class="fb-icon">üí¨</span>General
                    </button>
                </div>
                <textarea class="feedback-textarea" id="feedbackMessage" placeholder="Tell us what happened or what you'd like to see..."></textarea>
                <div class="feedback-context-note" id="feedbackContextNote">
                    We'll automatically include your device info and current screen to help us fix issues faster.
                </div>
                <button class="feedback-submit-btn" id="feedbackSubmitBtn" disabled>Send Feedback</button>
            </div>
        </div>
    </div>

    <!-- ==================== SCRIPTS ==================== -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/feed.js"></script>
    <script src="js/scout.js"></script>
    <script src="js/tracking.js"></script>
    <script src="js/profile.js"></script>
    <script src="js/recycling.js"></script>
    <script src="js/events.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
